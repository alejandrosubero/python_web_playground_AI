<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Python Playground</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <style>
        :root {
            --bg-dark: #121212;
            --editor-bg:#000;
            --btn-run: #27ae60;
            --btn-clear: #34495e;
            --tab-active: #3498db;
            --syn-base: #abb2bf;
            --syn-comment: #6a9955;
            --syn-keyword: #c678dd;
            --syn-string: #ce9178;
            --syn-func:   #dcdcaa;
            --syn-number: #d19a66;
            --syn-operator: #56b6c2;
        }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            font-family: -apple-system, system-ui, sans-serif;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: white;
        }

        header {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-dark);
            border-bottom: 1px solid #333;
        }

        .logo-section img { width: 30px; height: 30px; }

        .header-btns { display: flex; gap: 8px; }
        .btn {
            border: none; border-radius: 4px; font-weight: bold; font-size: 16px;
            padding: 8px 24px; color: white; display: flex; align-items: center; gap: 5px;
        }
        .btn-run { background: var(--btn-run); }
        .btn-clear { background: var(--btn-clear); }

        #editor-container { flex: 1; display: block; background: var(--editor-bg); }

        .CodeMirror {
            height: 100%;
            background: var(--editor-bg) !important;
            color: var(--syn-base) !important;
            font-family: 'SF Mono', 'Menlo', 'Monaco', monospace;
            font-size: 16px;
        }
        .CodeMirror-gutters { background: var(--editor-bg); border: none; }
        .CodeMirror-linenumber { color: #5c6370; }
        .CodeMirror-cursor { border-left: 2px solid white !important; }

        .cm-s-default .CodeMirror-line { color: var(--syn-base); }
        .cm-comment { color: var(--syn-comment) !important; }
        .cm-keyword { color: var(--syn-keyword) !important; }
        .cm-string { color: var(--syn-string) !important; }
        .cm-builtin { color: var(--syn-func) !important; }
        .cm-def { color: var(--syn-func) !important; }
        .cm-variable { color: var(--syn-base) !important; }
        .cm-number { color: var(--syn-number) !important; }
        .cm-operator { color: var(--syn-operator) !important; }

        #output-container {
            flex: 1; display: none; background: #000;
            padding: 15px; font-family: monospace; font-size: 14px; overflow-y: auto;
        }

        .tab-bar { display: flex; background: #1a1a1a; padding-bottom: env(safe-area-inset-bottom); }
        .tab {
            flex: 1; text-align: center; padding: 15px;
            font-weight: bold; color: #666; text-transform: uppercase; font-size: 14px;
        }
        .tab.active { color: var(--tab-active); border-bottom: 3px solid var(--tab-active); }

        #loader {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid var(--tab-active); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p style="color: #888; margin-top: 15px;">Cargando Python...</p>
</div>

<header>
 <div class="logo-section">
    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg" alt="Python" style="width: 30px; height: 30px;">
</div>
    <div class="header-btns">
        <button id="run-btn" class="btn btn-run" onclick="runPython()">▶ Run</button>
        <button class="btn btn-clear" onclick="handleClear()">Clear</button>
    </div>
</header>

<div id="editor-container">
    <textarea id="editor"># Python Playground
import sys

def greet(name):
    return f"Hello, {name}!"

print("System Version:", sys.version[:5])
print(greet("Developer"))

# Matemáticas simples
numbers = [1, 2, 3, 4, 5]
squares = [n**2 for n in numbers]
print(f"Squares of {numbers}: {squares}")</textarea>
</div>

<div id="output-container"></div>

<div class="tab-bar">
    <div id="tab-code" class="tab active" onclick="switchTab('code')">Code</div>
    <div id="tab-output" class="tab" onclick="switchTab('output')">Output</div>
</div>

<script>
    let pyodide = null;
    let editor = null;
    let currentTab = 'code';

    function initEditor() {
        editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            mode: "python",
            lineNumbers: true,
            indentUnit: 4,
            autoCloseBrackets: true,
            theme: "default"
        });
    }

    async function startPython() {
        try {
            pyodide = await loadPyodide();
            await pyodide.runPythonAsync(`
                import sys, io
                from js import printToConsole
                class Output(io.TextIOBase):
                    def write(self, t):
                        if t.strip(): printToConsole(t)
                        return len(t)
                sys.stdout = Output()
                sys.stderr = Output()
            `);
            document.getElementById("loader").style.display = "none";
        } catch (e) { console.error(e); }
    }

    window.printToConsole = (text) => {
        const out = document.getElementById("output-container");
        out.innerHTML += `<div style="margin-bottom:5px; color:#2a782f;">> ${text}</div>`;
        out.scrollTop = out.scrollHeight;
    };

    function switchTab(target) {
        currentTab = target;
        const codeCont = document.getElementById("editor-container");
        const outCont = document.getElementById("output-container");
        const tabCode = document.getElementById("tab-code");
        const tabOut = document.getElementById("tab-output");

        if (target === 'code') {
            codeCont.style.display = "block";
            outCont.style.display = "none";
            tabCode.classList.add('active');
            tabOut.classList.remove('active');
            editor.refresh();
        } else {
            codeCont.style.display = "none";
            outCont.style.display = "block";
            tabCode.classList.remove('active');
            tabOut.classList.add('active');
        }
    }

    // Nueva función inteligente para el botón Clear
    function handleClear() {
        if (currentTab === 'code') {
            if (confirm("¿Borrar todo el código?")) {
                editor.setValue("");
            }
        } else {
            // No pide confirmación para limpiar la consola, es un proceso más común
            document.getElementById("output-container").innerHTML = "";
        }
    }

    async function runPython() {
        const out = document.getElementById("output-container");
        out.innerHTML = '<div style="color: #666; margin-bottom:10px;">-- Ejecutando --</div>';
        switchTab('output');
        
        try {
            await pyodide.runPythonAsync(editor.getValue());
        } catch (err) {
            out.innerHTML += `<div style="color: #ff453a;">${err}</div>`;
        }
    }

    initEditor();
    startPython();
</script>
</body>
</html>